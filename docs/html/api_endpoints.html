<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Endpoints - AV Catalog Converter Documentation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        h3 {
            margin-top: 25px;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            overflow: auto;
            position: relative;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .copy-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }
        .copy-btn:hover {
            background-color: #2980b9;
        }
        .command-container {
            position: relative;
            margin-bottom: 15px;
        }
        ul, ol {
            padding-left: 25px;
        }
        .endpoint {
            background-color: #f0f7fb;
            border-left: 5px solid #3498db;
            padding: 10px;
            margin-bottom: 15px;
        }
        .project-structure {
            font-family: 'Courier New', Courier, monospace;
            white-space: pre;
            line-height: 1.3;
        }
        .component {
            background-color: #f9f9f9;
            border-left: 3px solid #2ecc71;
            padding: 10px;
            margin-bottom: 10px;
        }
        .note {
            background-color: #fff8dc;
            border-left: 5px solid #f1c40f;
            padding: 10px;
            margin-bottom: 15px;
        }
        .warning {
            background-color: #ffebee;
            border-left: 5px solid #f44336;
            padding: 10px;
            margin-bottom: 15px;
        }
        .toc {
            background-color: #f8f9fa;
            border: 1px solid #eaecef;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 15px;
        }
        .toc li {
            margin-bottom: 5px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .breadcrumb {
            margin-bottom: 20px;
            font-size: 14px;
        }
        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        .method {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-right: 10px;
        }
        .get {
            background-color: #61affe;
        }
        .post {
            background-color: #49cc90;
        }
        .put {
            background-color: #fca130;
        }
        .delete {
            background-color: #f93e3e;
        }
        .path {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
        }
        .param-name {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            color: #0366d6;
        }
        .param-type {
            font-size: 12px;
            color: #6c757d;
        }
        .status-code {
            font-weight: bold;
        }
        .status-200 {
            color: #49cc90;
        }
        .status-400 {
            color: #fca130;
        }
        .status-500 {
            color: #f93e3e;
        }
    </style>
</head>
<body>
    <div class="breadcrumb">
        <a href="index.html">Home</a> &gt; <a href="api_reference.html">API Reference</a> &gt; API Endpoints
    </div>

    <h1>API Endpoints</h1>
    
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#base-url">Base URL</a></li>
            <li><a href="#authentication">Authentication</a></li>
            <li><a href="#endpoints">Endpoints</a>
                <ul>
                    <li><a href="#health-check">Health Check</a></li>
                    <li><a href="#upload-file">Upload File</a></li>
                    <li><a href="#analyze-file">Analyze File</a></li>
                    <li><a href="#map-fields">Map Fields</a></li>
                </ul>
            </li>
            <li><a href="#error-handling">Error Handling</a></li>
            <li><a href="#rate-limiting">Rate Limiting</a></li>
            <li><a href="#examples">Usage Examples</a></li>
        </ul>
    </div>

    <h2 id="overview">Overview</h2>
    <p>
        The AV Catalog Converter provides a RESTful API for converting and standardizing catalog data.
        The API allows you to upload files, analyze their structure, map fields, and convert them to
        standardized formats.
    </p>
    <p>
        All API endpoints return JSON responses (except for file downloads) and use standard HTTP status codes.
    </p>

    <h2 id="base-url">Base URL</h2>
    <p>
        The base URL for all API endpoints is:
    </p>
    <pre><code>http://&lt;host&gt;:&lt;port&gt;/api</code></pre>
    <p>
        Where <code>&lt;host&gt;</code> is the hostname or IP address of the server, and <code>&lt;port&gt;</code>
        is the port number (default: 8080).
    </p>

    <h2 id="authentication">Authentication</h2>
    <p>
        The API currently does not require authentication. However, future versions may implement
        API key-based authentication for security.
    </p>
    <div class="warning">
        <p>
            <strong>Note:</strong> Since the API does not currently require authentication, it should only be
            exposed on trusted networks or behind a secure proxy.
        </p>
    </div>

    <h2 id="endpoints">Endpoints</h2>
    
    <h3 id="health-check">Health Check</h3>
    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/health</span>
        <p>
            Returns basic information about the application status. This endpoint can be used to verify
            that the API is running properly.
        </p>
        
        <h4>Request</h4>
        <p>No parameters required.</p>
        
        <h4>Response</h4>
        <p>Returns a JSON object with the following properties:</p>
        <table>
            <tr>
                <th>Property</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>status</td>
                <td>string</td>
                <td>Status of the application ("ok" or "error")</td>
            </tr>
            <tr>
                <td>version</td>
                <td>string</td>
                <td>Version of the application</td>
            </tr>
            <tr>
                <td>app_name</td>
                <td>string</td>
                <td>Name of the application</td>
            </tr>
            <tr>
                <td>timestamp</td>
                <td>number</td>
                <td>Current timestamp</td>
            </tr>
            <tr>
                <td>environment</td>
                <td>string</td>
                <td>Environment (production, development, etc.)</td>
            </tr>
            <tr>
                <td>llm_info</td>
                <td>object</td>
                <td>Information about the LLM (if available)</td>
            </tr>
        </table>
        
        <h4>Example Response</h4>
        <pre><code>{
    "status": "ok",
    "version": "1.0.0",
    "app_name": "AV Catalog Converter",
    "timestamp": 1623456789.123,
    "environment": "production",
    "llm_info": {
        "model_id": "microsoft/phi-2",
        "quantization": null,
        "max_tokens": 512
    }
}</code></pre>
        
        <h4>Status Codes</h4>
        <ul>
            <li><span class="status-code status-200">200 OK</span> - The request was successful</li>
            <li><span class="status-code status-500">500 Internal Server Error</span> - An error occurred on the server</li>
        </ul>
    </div>

    <h3 id="upload-file">Upload File</h3>
    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/upload</span>
        <p>
            Uploads and processes a catalog file. The file is processed through the standardization pipeline
            and returned in the requested format.
        </p>
        
        <h4>Request</h4>
        <p>The request should be a <code>multipart/form-data</code> request with the following parameters:</p>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>file</td>
                <td>file</td>
                <td>Yes</td>
                <td>The catalog file to process</td>
            </tr>
            <tr>
                <td>format</td>
                <td>string</td>
                <td>No</td>
                <td>Output format (csv, excel, json). Default: csv</td>
            </tr>
        </table>
        
        <h4>Response</h4>
        <p>Returns the processed file as an attachment with the appropriate MIME type.</p>
        
        <h4>Error Response</h4>
        <p>In case of an error, returns a JSON object with the following properties:</p>
        <table>
            <tr>
                <th>Property</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>error</td>
                <td>string</td>
                <td>Error type</td>
            </tr>
            <tr>
                <td>details</td>
                <td>string</td>
                <td>Detailed error message</td>
            </tr>
            <tr>
                <td>suggestions</td>
                <td>array</td>
                <td>Suggestions for resolving the error (optional)</td>
            </tr>
        </table>
        
        <h4>Example Error Response</h4>
        <pre><code>{
    "error": "Processing failed",
    "details": "File corruption: The file appears to be corrupted or in an invalid format.",
    "suggestions": [
        "Check that the file format is supported",
        "Ensure the file is not corrupted",
        "Try a different file format"
    ]
}</code></pre>
        
        <h4>Status Codes</h4>
        <ul>
            <li><span class="status-code status-200">200 OK</span> - The request was successful</li>
            <li><span class="status-code status-400">400 Bad Request</span> - Invalid request parameters</li>
            <li><span class="status-code status-500">500 Internal Server Error</span> - An error occurred during processing</li>
        </ul>
    </div>

    <h3 id="analyze-file">Analyze File</h3>
    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/analyze</span>
        <p>
            Analyzes a catalog file structure without performing the full standardization process.
            Returns information about the file structure, column types, and a sample of the data.
        </p>
        
        <h4>Request</h4>
        <p>The request should be a <code>multipart/form-data</code> request with the following parameters:</p>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>file</td>
                <td>file</td>
                <td>Yes</td>
                <td>The catalog file to analyze</td>
            </tr>
        </table>
        
        <h4>Response</h4>
        <p>Returns a JSON object with the following properties:</p>
        <table>
            <tr>
                <th>Property</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>structure</td>
                <td>object</td>
                <td>Structure analysis results</td>
            </tr>
            <tr>
                <td>sample_data</td>
                <td>array</td>
                <td>Sample of the data (up to 10 rows)</td>
            </tr>
            <tr>
                <td>columns</td>
                <td>array</td>
                <td>List of column names</td>
            </tr>
            <tr>
                <td>file_info</td>
                <td>object</td>
                <td>Information about the file</td>
            </tr>
            <tr>
                <td>llm_info</td>
                <td>object</td>
                <td>Information about the LLM (if available)</td>
            </tr>
        </table>
        
        <h4>Example Response</h4>
        <pre><code>{
    "structure": {
        "column_types": {
            "Product Code": {
                "type": "id",
                "unique_count": 100,
                "unique_ratio": 1.0,
                "sample_values": ["ABC123", "DEF456", "GHI789", "JKL012", "MNO345"],
                "empty": false
            },
            "Product Name": {
                "type": "string",
                "unique_count": 98,
                "unique_ratio": 0.98,
                "sample_values": ["Sony 65-inch TV", "Samsung Soundbar", "LG Refrigerator", "Bose Headphones", "Apple iPad"],
                "empty": false
            }
            // More columns...
        },
        "data_quality": {
            "missing_values": {
                "Manufacturer SKU": {
                    "count": 10,
                    "percentage": 10.0
                }
            },
            "duplicates": {
                "rows": {
                    "count": 2,
                    "percentage": 2.0
                }
            }
        },
        // More structure information...
    },
    "sample_data": [
        {
            "Product Code": "ABC123",
            "Product Name": "Sony 65-inch TV",
            "Description": "4K OLED TV with HDR",
            "Brand": "Sony",
            "Price": "1299.99"
        },
        // More sample rows...
    ],
    "columns": ["Product Code", "Product Name", "Description", "Brand", "Price"],
    "file_info": {
        "filename": "catalog.csv",
        "size": 12345,
        "parser": "CSVParser"
    },
    "llm_info": {
        "model_id": "microsoft/phi-2",
        "quantization": null,
        "max_tokens": 512
    }
}</code></pre>
        
        <h4>Status Codes</h4>
        <ul>
            <li><span class="status-code status-200">200 OK</span> - The request was successful</li>
            <li><span class="status-code status-400">400 Bad Request</span> - Invalid request parameters</li>
            <li><span class="status-code status-500">500 Internal Server Error</span> - An error occurred during analysis</li>
        </ul>
    </div>

    <h3 id="map-fields">Map Fields</h3>
    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/map-fields</span>
        <p>
            Maps fields from input columns to standardized format. This endpoint accepts column names and
            sample data and returns suggested mappings to the standardized schema.
        </p>
        
        <h4>Request</h4>
        <p>The request should be a JSON object with the following properties:</p>
        <table>
            <tr>
                <th>Property</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>columns</td>
                <td>array</td>
                <td>Yes</td>
                <td>Array of column names</td>
            </tr>
            <tr>
                <td>sample_data</td>
                <td>array</td>
                <td>Yes</td>
                <td>Array of sample data objects</td>
            </tr>
        </table>
        
        <h4>Example Request</h4>
        <pre><code>{
    "columns": ["Product Code", "Product Name", "Description", "Brand", "Price"],
    "sample_data": [
        {
            "Product Code": "ABC123",
            "Product Name": "Sony 65-inch TV",
            "Description": "4K OLED TV with HDR",
            "Brand": "Sony",
            "Price": "1299.99"
        },
        {
            "Product Code": "DEF456",
            "Product Name": "Samsung Soundbar",
            "Description": "Dolby Atmos Soundbar",
            "Brand": "Samsung",
            "Price": "499.99"
        }
    ]
}</code></pre>
        
        <h4>Response</h4>
        <p>Returns a JSON object with the following properties:</p>
        <table>
            <tr>
                <th>Property</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>mappings</td>
                <td>array</td>
                <td>Array of field mapping objects</td>
            </tr>
            <tr>
                <td>notes</td>
                <td>string</td>
                <td>Additional notes about the mapping</td>
            </tr>
            <tr>
                <td>request_info</td>
                <td>object</td>
                <td>Information about the request</td>
            </tr>
        </table>
        
        <h4>Example Response</h4>
        <pre><code>{
    "mappings": [
        {
            "source_field": "Product Code",
            "target_field": "SKU",
            "confidence": 0.9,
            "reasoning": "Column contains unique alphanumeric codes that match the pattern of SKUs"
        },
        {
            "source_field": "Product Name",
            "target_field": "Short Description",
            "confidence": 0.85,
            "reasoning": "Column contains brief product descriptions"
        },
        {
            "source_field": "Description",
            "target_field": "Long Description",
            "confidence": 0.8,
            "reasoning": "Column contains detailed product descriptions"
        },
        {
            "source_field": "Brand",
            "target_field": "Manufacturer",
            "confidence": 0.95,
            "reasoning": "Column contains manufacturer/brand names"
        },
        {
            "source_field": "Price",
            "target_field": "Trade Price",
            "confidence": 0.7,
            "reasoning": "Column contains price values without currency indicators"
        }
    ],
    "notes": "All required fields have been mapped successfully.",
    "request_info": {
        "column_count": 5,
        "sample_row_count": 2,
        "timestamp": 1623456789.123,
        "llm_stats": {
            "total_generations": 1,
            "total_tokens_generated": 256,
            "average_generation_time": 0.5
        }
    }
}</code></pre>
        
        <h4>Status Codes</h4>
        <ul>
            <li><span class="status-code status-200">200 OK</span> - The request was successful</li>
            <li><span class="status-code status-400">400 Bad Request</span> - Invalid request parameters</li>
            <li><span class="status-code status-415">415 Unsupported Media Type</span> - Request is not JSON</li>
            <li><span class="status-code status-500">500 Internal Server Error</span> - An error occurred during mapping</li>
        </ul>
    </div>

    <h2 id="error-handling">Error Handling</h2>
    <p>
        All API endpoints return standard HTTP status codes to indicate success or failure.
        In case of an error, the response body will contain a JSON object with details about the error.
    </p>
    <table>
        <tr>
            <th>Status Code</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>200 OK</td>
            <td>The request was successful</td>
        </tr>
        <tr>
            <td>400 Bad Request</td>
            <td>Invalid request parameters</td>
        </tr>
        <tr>
            <td>404 Not Found</td>
            <td>The requested resource was not found</td>
        </tr>
        <tr>
            <td>415 Unsupported Media Type</td>
            <td>The request content type is not supported</td>
        </tr>
        <tr>
            <td>500 Internal Server Error</td>
            <td>An error occurred on the server</td>
        </tr>
    </table>

    <h2 id="rate-limiting">Rate Limiting</h2>
    <p>
        The API currently does not implement rate limiting at the HTTP level. However, the LLM integration
        uses token bucket-based rate limiting to prevent overloading the model. If the rate limit is exceeded,
        the API will still accept requests, but the LLM-dependent operations may be delayed or rejected.
    </p>
    <div class="note">
        <p>
            <strong>Note:</strong> Future versions of the API may implement HTTP-level rate limiting to
            protect the server from excessive requests.
        </p>
    </div>

    <h2 id="examples">Usage Examples</h2>
    <p>
        Here are some examples of how to use the API with common HTTP clients:
    </p>
    <h3>cURL</h3>
    <pre><code># Health check
curl -X GET http://localhost:8080/api/health

# Upload file
curl -X POST http://localhost:8080/api/upload \
  -F "file=@catalog.csv" \
  -F "format=csv" \
  -o standardized_catalog.csv

# Analyze file
curl -X POST http://localhost:8080/api/analyze \
  -F "file=@catalog.csv" \
  -o analysis.json

# Map fields
curl -X POST http://localhost:8080/api/map-fields \
  -H "Content-Type: application/json" \
  -d '{
    "columns": ["Product Code", "Product Name", "Description", "Brand", "Price"],
    "sample_data": [
      {
        "Product Code": "ABC123",
        "Product Name": "Sony 65-inch TV",
        "Description": "4K OLED TV with HDR",
        "Brand": "Sony",
        "Price": "1299.99"
      }
    ]
  }' \
  -o mappings.json</code></pre>

    <h3>Python (requests)</h3>
    <pre><code>import requests
import json

# Base URL
base_url = "http://localhost:8080/api"

# Health check
response = requests.get(f"{base_url}/health")
print(json.dumps(response.json(), indent=2))

# Upload file
with open("catalog.csv", "rb") as f:
    files = {"file": f}
    data = {"format": "csv"}
    response = requests.post(f"{base_url}/upload", files=files, data=data)
    with open("standardized_catalog.csv", "wb") as out:
        out.write(response.content)

# Analyze file
with open("catalog.csv", "rb") as f:
    files = {"file": f}
    response = requests.post(f"{base_url}/analyze", files=files)
    print(json.dumps(response.json(), indent=2))

# Map fields
data = {
    "columns": ["Product Code", "Product Name", "Description", "Brand", "Price"],
    "sample_data": [
        {
            "Product Code": "ABC123",
            "Product Name": "Sony 65-inch TV",
            "Description": "4K OLED TV with HDR",
            "Brand": "Sony",
            "Price": "1299.99"
        }
    ]
}
response = requests.post(f"{base_url}/map-fields", json=data)
print(json.dumps(response.json(), indent=2))</code></pre>

    <div class="note">
        <p>
            <strong>Note:</strong> For more detailed information about the API, refer to the OpenAPI specification
            in <code>docs/openapi.yaml</code>.
        </p>
    </div>

    <script>
        function copyToClipboard(button) {
            const pre = button.previousElementSibling;
            const text = pre.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }
    </script>
</body>
</html>
